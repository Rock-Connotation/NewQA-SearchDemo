#  邮问迭代踩坑记录

##  搜索初始页

### 如何实现搜索框提示内容每五秒钟进行轮播

- 解决思路：NSTimer，无限for循环

#### 热门搜索的btn如何实现动态的排列

- 解决思路：

  1.设置最大量x（屏幕宽度），最大量y（父视图的height）

  2.设置中间量进行标记，当下一个button的x超过宽度，则换行

- 解决方案1：参照掌邮的HistoryView的逻辑

- 解决方案2:掌邮的HistoryView的逻辑的优化：

  解决方案1的逻辑是进行masonry布局，有些麻烦，每一次都要layouIfNeeded，我采用直接赋值frame，减少了一些性能损耗。

### 热门搜索按钮实现button宽度随title的内容自适应

- 解决方案：

  ` self.titleLabel.adjustsFontSizeToFitWidth = YES;`

### 自定义cell过后发现无法实现点击cell事件

- 解决方案：

  `_historyTable.allowsSelection = YES;`

### 缓存网络请求：解、归档

### 搜索结果页的知识库和table的网络请求

- 问题描述：知识库和table是两个网络接口，需要在获取到两个网络请求之后，判断是否都请求成功来判断进入哪一个界面，判断请求成功后数据中处理后的数据是否为空是来进入下一个界面进行view布局。因下一个界面的布局需要用到请求数据中的某些数据。

- 解决方案

  - 利用GCD的信号量，确保两个网络请求完成之后进行数据处理再跳转到下一个界面

  -  非GCD处理：
    - 设置两个bool变量，即是否获取网络数据失败
    - 两个网络请求中都进入到数据逻辑处理方法：成功则直接进入，失败则对应的bool值设置为YES后再进入方法
    - 数据处理方法：
      - 1.判断是否两个网络数据获取都有值（不论成功或者失败），任意一个没有则返回，确保不论是两个网络请求都完成
      - 2.判断是否都请求成功
      - 3.判断请求之后处理的数据如何，再进行传值然后进行跳转

##  搜索无结果页

### 在搜索无结果页和搜索结果页搜索的时候，进行搜索时，无法在搜索初始页就刷新历史记录

- 解决方案：利用通知中心进行通知，当在此页面搜索时，将搜索内容存入缓存，然后发出通知。搜索初始页接收到通知之后读取缓存历史记录，然后刷新table

## 搜索结果页



##  发布动态页

### 添加图片出现的bug

- 问题：出现了点击选择三张图片，但是只显示出一张或者两张，在删除一张图片之后其他两张又冒出来了。
- 原因：PHPicker在获取图片时时异步执行，我for循环获取多张，并设置在i在最后一位时执行添加图片诓并约束的方法。但是因为其异步执行无序，所以可能i为最后一位时被先执行，就先添加图片诓，并进行约束呈现
- 解决方案：利用GCD的group，确保获取完所有执行方法之后再再notify回调中执行图片框的添加和约束
- **注意：在异步进行进行网络请求异步耗时操作时等方法时，不要用group、包括栅栏函数，应该使用信号量，或者发布结果页获取数据时的手段**

### 标签的button利用背景图片来达到点击之后变换背景颜色功能时导致button的size很奇怪的情况

- 解决方案：不利用背景图片而直接使用背景颜色的更改

### 在用scrollview作为主界面时的问题

- 问题描述：scrollview的frame等于vc的view的Frame的时候，顶不距离状态栏有一定的距离

  

